<!doctype html>
<html lang="pl">
	<head>
		<meta charset="UTF-8" />
		<title>Rejestracja</title>
	</head>
	<body>
		<h2>Rejestracja</h2>

		<form id="registerForm">
			<input type="email" placeholder="Email" required />
			<input type="password" placeholder="Hasło" required />
			<button>Załóż konto</button>
		</form>

		<script>
			const bcrypt = require('bcrypt');

			app.post('/api/register', async (req, res) => {
				const { email, password } = req.body;

				if (!email || !password) {
					return res.status(400).json({ error: 'Brak danych' });
				}

				const exists = await User.findOne({ email });
				if (exists) {
					return res.status(400).json({ error: 'Użytkownik istnieje' });
				}

				const hash = await bcrypt.hash(password, 10);

				const user = await User.create({
					email,
					password: hash,
				});

				req.session.user = {
					id: user._id,
					email: user.email,
				};

				res.json({ ok: true });
			});
		</script>
	</body>
</html>
